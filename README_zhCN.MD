[English](README.MD) | 简体中文
## Jamella's Diablo 2 Hero Editor ##
###### Visual Studio 2019完整源代码和项目文件
---------------------------------------------------------------
以前玩暗黑2的时候就下载过JamellaD2E这个工具，硬啃半生不熟的英语来修改角色和装备，当时就觉得这工具太牛逼了，给我幼小的心灵带来了极大的震撼，现在无意中居然发现了这工具的源代码，太巧了。

---------------------------------------------------------------
#### 说明
JamellaD2E的源代码是以一个PDF文件发布的，源文件在此：[jamella-diablo-ii-source-code.pdf](docs/jamella-diablo-ii-source-code.pdf)

我已经把代码全部复制出来了，建立了项目，现在可以在VS2019里编译链接生成了。

以下是PDF源文件中Jamella的发布说明：
>---------------------------------------------------------------
> #### <center>Jamella’s Diablo 2 Editor的源代码</center>
> #### <center>2001-03-17</center>
>
>这份源代码是我的知识产权，完全由我自己编写，现在发布出来以便于程序猿们及其他有兴趣的人可以研究下它的内部实现。
>
>如果你使用了这份代码中的一部分，请想一想我曾经花了大半年的时间来写这个程序，如果你不介意，请在你的程序的<关于>对话框中标出我的名字。
>
>除此之外，你会发现我在发布编辑器3.0版本后所做的一些修改，所以如果您发现一些额外的功能和无用的代码段，请不要感到惊讶。
>
>同时请不要给我发邮件问如何让这份代码跑起来，因为他就是这么跑起来的，而且我没有时间来教你如何使用C++面向对象编程。
>现在，从阅读头文件开始了解这份代码吧。
>
>
>Jamella
>
>http://jamella.cjb.net
>
>jamella@gmx.net
>
>---------------------------------------------------------------

#### 收集源代码:
```
1. 用<Google Chrome>浏览器打开PDF文件.
2. 复制粘贴所有内容到<pdf.txt>.
3. 从txt文件中删除PDF第一页的内容(readme部分).
4. 用正则表达式同时拿到每一页的文件名和文件内容.
5. 保存为源代码文件.
```

正则表达式的相关步骤在这个文件里: [index.ts](typescript/index.ts)

这份脚本是用TypeScript编写，NodeJS运行的，现在已经不需要再运行了。

源代码现在还不能编译，因为还有一些问题需要解决。

---------------------------------------------------------------
#### 换行问题

首先，大部分文件中都会有换行问题，源代码会在错误的位置换行，比如在字符串中间，出现此问题是因为PDF文件会自动把过长的行自动换行，所以我用VS2019和VSCode格式化并且修改了所有的文件，以确保在用VS2019查看代码的时候不会出现错误。

---------------------------------------------------------------
#### 收集资源文件

[tytannial](https://github.com/tytannial)在[#1](https://github.com/zhaoleimxd/JamellaD2E/issues/1)里给我提供了一份`3.0`版本的`JamellaD2E`，我从中提取了所有丢失的资源文件，现在资源已经完美了。

---------------------------------------------------------------
#### 编译

##### 关于警告
在编译过程中会有很多警告，原因是这项目是用VC6写的，所以我在项目中禁用了下面这些警告。
```
26451;6328;28183;6011;6386;4996;4552;4477;4554;4474;4258;
```

##### 循环问题
源代码中有个很有趣的事情，Jamella写循环的风格是下面这样的：
```
for (int i = 0; i < 100; i++>) {
    // 代码...
}

// 代码...
int a = i; // 他并没有声明变量i，就直接使用了，因为在上面的循环中已经声明过了
```
这个习惯在VS2019中会报错，所以我把这些在编译中会报错的的代码全都做了修改。

##### CRT警告
因为这项目是VC6时代的,VS提供的C运行库到现在已经有了很大的变化，我不得不加上`_CRT_SECURE_NO_WARNINGS`宏来保证不再出现CRT警告。

##### 宏
JamellaD2E看起来有两个项目，你可以在`JamellaD2E.h`中看到：
* Jamella's Diablo 2 Hero Editor
* Jamella's COM Object

他用宏来控制代码中的声明部分

宏|项目
---|:---:
`JAMELLAEDITOR`|Jamella's Diablo 2 Hero Editor
`JAMELLACOMSERVER`|Jamella's COM Object

我为此项目添加了`JAMELLAEDITOR`宏。
在`JamellaD2E.h`中仍然有很多宏，如果你有兴趣可以自己看看。

##### 字符串常量问题
在VC6年代，你可以像下面这样写代码，并且没有警告和错误：
```
char* sz = "Hello, World.";
```
现在在VS2019中，他会报警告和错误，必须得这么写才行：
```
const char* sz = "Hello, World.";
```
为了解决这个问题，我修改了项目的`符合模式`为否，并且禁用了`SDL检查`。

---------------------------------------------------------------
#### 链接
现在我们可以编译所有文件了，但是在链接时会缺少一些静态导入库。
* `comctl32.lib` 用于Windows通用组件库。
* `Winmm.lib` 用于播放声音。

我已经将他们加入了项目配置中。

---------------------------------------------------------------
#### 结束
以上工作都做完后，终于得到了一个自己生成出的JamellaD2E，我的目的仅此而已，现在可以生成和调试了，并且可以看看他是怎么实现的。

---------------------------------------------------------------
* `Jamella`编写并开源
* `zhaoleimxd`转换为VS2019项目
* 特别感谢`Nedkali`提供的资源文件
* 特别感谢`tytannial`提供3.0版本的程序以提取资源文件

2021-10-09
